# tasks/views.py
from django.shortcuts import render, redirect

# Временное хранилище задач (в реальном приложении используем базу данных)
# Это глобальная переменная, которая будет хранить задачи в памяти
# ВНИМАНИЕ: при перезагрузке сервера все задачи будут потеряны!
tasks_list = []

def view_tasks(request):
    """
    Отображает страницу со списком всех задач.

    Если список задач пуст, отображается сообщение об этом.
    В противном случае отображается список всех задач.
    """
    context = {
        'tasks': tasks_list,
        'title': 'Мои задачи'
    }
    return render(request, 'view_tasks.html', context)

def add_task(request):
    """
    Обрабатывает добавление новой задачи через POST запрос.

    Если метод запроса POST, извлекает данные формы (название задачи)
    и добавляет новую задачу в список. После успешного добавления
    перенаправляет пользователя на страницу со списком задач.

    Если метод GET, просто отображает форму для добавления задачи.
    """
    if request.method == 'POST':
        # Извлекаем данные из POST запроса
        task_title = request.POST.get('task_title', '').strip()

        # Проверяем, что поле не пустое
        if task_title:
            # Добавляем задачу в список
            # В реальном приложении здесь будет сохранение в базу данных
            tasks_list.append({
                'id': len(tasks_list) + 1,
                'title': task_title,
                'completed': False
            })

            # Перенаправляем на страницу со списком задач
            # Это предотвращает повторную отправку формы при обновлении страницы
            return redirect('view_tasks')

    # Если метод GET или если форма невалидна, отображаем форму
    context = {
        'title': 'Добавить задачу'
    }
    return render(request, 'add.html', context)
